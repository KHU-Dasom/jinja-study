# **DHCP**

## **π DHCPλ€?**

- Dynamic Host Configuration Protocolμ μ•½μλ΅ Host IP κµ¬μ„± κ΄€λ¦¬λ¥Ό λ‹¨μν™”ν•λ” IP ν‘μ¤€ ν”„λ΅ν† μ½μ„.
- μ‰½κ² λ§ν•΄μ„ DHCP μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ IPμ£Όμ†, μ„λΈλ„· λ§μ¤ν¬, κ²μ΄νΈμ›¨μ΄, DNS μ„λ²„ λ“±μ μ •λ³΄λ¥Ό μλ™μΌλ΅ ν• λ‹Ήν•΄μ£Όλ” ν”„λ΅ν† μ½μ΄λΌκ³  μƒκ°ν•λ©΄ λ¨.
- λ„¤νΈμ›ν¬ κ΄€λ¦¬μκ°€ ν•΄μ•Ό ν•  μ‘μ—…μ„ κ°„μ†ν™”ν•λ©°, DHCP μ—†μ΄λ” μλ™μΌλ΅ IP μ£Όμ†λ¥Ό ν• λ‹Ήν•΄μ•Ό ν•¨.

## **π“– DHCP λ™μ‘ λ°©μ‹**

- ν΄λΌμ΄μ–ΈνΈκ°€ λ„¤νΈμ›ν¬μ— μ—°κ²° μ‹ IPμ£Όμ†λ¥Ό μ”μ²­ν•¨.
- IPμ£Όμ† μ”μ²­μ€ DHCP μ„λ²„λ΅ μ „λ‹¬λλ©° μ„λ²„λ” μ£Όμ†λ¥Ό ν• λ‹Ήν•κ³  λ¨λ‹ν„°λ§ν•λ©° μ—°κ²° ν•΄μ  μ‹ μ£Όμ†λ¥Ό λ‹¤μ‹ κ°€μ Έμ΄.
- ν•΄λ‹Ή IPμ£Όμ†λ” λ‹¤λ¥Έ ν΄λΌμ΄μ–ΈνΈμ— μ¬ν• λ‹Ήν•  μ μμ.
- ν΄λΌμ΄μ–ΈνΈλ” IPμ£Όμ†λ¥Ό μ΄μ©ν•΄ λ‚΄λ¶€ λ° κ³µμ© λ„¤νΈμ›ν¬μ™€ ν†µμ‹ ν•  μ μμ.

---

- DHCPμ λ™μ‘ λ°©μ‹μ—λ” Lease(μ„λ€), Renewal(κ°±μ‹ ), Release(ν•΄μ )κ°€ μμ.
  - DHCPλ¥Ό ν†µν• IPμ£Όμ† ν• λ‹Ήμ€ μ„λ€ κ°λ…μ„.
  - DHCP μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ—κ² μκµ¬μ μΌλ΅ IPμ£Όμ†λ¥Ό ν• λ‹Ήν•λ” κ²ƒμ΄ μ•„λ‹λΌ μ„λ€ κΈ°κ°„μ„ μ •ν•μ—¬ κ·Έ κΈ°κ°„ λ™μ•λ§ μ‚¬μ©ν•κ² ν•¨.
  - μ„λ€κΈ°κ°„ μ΄ν›„μ— ν•΄λ‹Ή IPμ£Όμ†λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ κ°±μ‹ (Renewal)μ„ ν•΄μ•Ό ν•¨.
  - λ” μ΄μƒ ν•΄λ‹Ή IPμ£Όμ†κ°€ ν•„μ”ν•μ§€ μ•λ‹¤λ©΄ ν•΄μ (Release)λ¥Ό ν•΄μ•Ό ν•¨.

### **Lease - DHCP DORA Process**


![dhcp_lease](https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-9300-series-switches/217366-configure-dhcp-in-ios-xe-evpn-vxlan-01.png)

1. DHCP Discover
   - ν΄λΌμ΄μ–ΈνΈκ°€ λ„¤νΈμ›ν¬μ— μ—°κ²° μ‹ `DISCOVER` λ©”μ‹μ§€λ¥Ό λΈλ΅λ“μΊμ¤νΈλ΅ μ „μ†΅ν•¨.
   - ν΄λΌμ΄μ–ΈνΈλ” DHCP μ„λ²„μ μ£Όμ†λ¥Ό λ¨λ¥΄κΈ° λ•λ¬Έμ— λΈλ΅λ“μΊμ¤νΈλ΅ μ „μ†΅ν•μ—¬ DHCP μ„λ²„λ¥Ό μ°Ύμ.
2. DHCP Offer
   - DHCP μ„λ²„λ” `OFFER` λ©”μ‹μ§€λ¥Ό μ λ‹μΊμ¤νΈ(λλ” λΈλ΅λ“μΊμ¤νΈ)λ΅ μ „μ†΅ν•¨.
   - DHCP μ„λ²„λ” `DISCOVER` λ©”μ‹μ§€λ¥Ό μμ‹ ν•λ©΄ `OFFER` λ©”μ‹μ§€λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅ν•¨.
   - κµ¬μ„± λ§¤κ°λ³€μ(μ: IP μ£Όμ†, μ„λΈλ„· λ§μ¤ν¬, κ²μ΄νΈμ›¨μ΄, DNS μ„λ²„ λ“±)λ¥Ό ν¬ν•¨ν•μ—¬ μ „μ†΅ν•¨.
3. DHCP Request
   - ν΄λΌμ΄μ–ΈνΈκ°€ `REQUEST` λ©”μ‹μ§€λ¥Ό λΈλ΅λ“μΊμ¤νΈλ΅ μ „μ†΅ν•¨.
   - DHCP μ„λ²„μ μ΅΄μ¬λ¥Ό μ•μ•κΈ° λ•λ¬Έμ— `REQUEST` λ©”μ„Έμ§€λ¥Ό ν†µν•΄ ν•λ‚μ DHCP μ„λ²„λ¥Ό μ„ νƒν•¨.
   - μ„ νƒν• DHCP μ„λ²„μ—κ² ν΄λΌμ΄μ–ΈνΈκ°€ μ‚¬μ©ν•  λ„¤νΈμ›ν¬ κµ¬μ„± λ§¤κ°λ³€μλ¥Ό μ”μ²­ν•¨.
4. DHCP Ack
   - DHCP μ„λ²„λ” `ACK` λ©”μ‹μ§€λ¥Ό μ λ‹μΊμ¤νΈ(λλ” λΈλ΅λ“μΊμ¤νΈ)λ΅ μ „μ†΅ν•¨.
   - ν΄λΌμ΄μ–ΈνΈκ°€ DHCP μ„λ²„λ΅ λ³΄λ‚Έ μ”μ²­ λ„¤νΈμ›ν¬ κµ¬μ„± λ§¤κ°λ³€μλ¥Ό ν™•μΈν• λ’¤ ν•΄λ‹Ή λ„¤νΈμ›ν¬ μ •λ³΄λ¥Ό μ „λ‹¬ν•΄ μ¤.

### **Renewal**

![dhcp_renewal](https://crnetpackets.files.wordpress.com/2017/04/dhcp-basics-renew4.png)

- μ„λ€ κΈ°κ°„μ΄ λλ‚¬μ„ λ• IPμ£Όμ† ν• λ‹Ήμ„ ν•΄μ ν•κ³  λ‹¤μ‹ μ„λ€ν•κ² λλ©΄ λ¶ν•„μ”ν• λΈλ΅λ“μΊμ¤νΈ νΈλν”½μ΄ λ°μƒν•¨.
- μ΄λ¥Ό μ„ν•΄ μ„λ€ κΈ°κ°„μ΄ λλ‚¬μ„ λ• μ„λ€ κΈ°κ°„μ„ μ—°μ¥ν•λ” Renewal κ³Όμ •μ΄ μ΅΄μ¬ν•¨.
- κ°±μ‹  κ³Όμ •μ—μ„λ” ν΄λΌμ΄μ–ΈνΈκ°€ DHCP μ„λ²„μ μ΅΄μ¬λ¥Ό μ•κ³  μκΈ° λ•λ¬Έμ— Discover & Offer κ³Όμ •μ΄ λ¶ν•„μ”ν•¨.

### **Release**

- μ„λ€ κΈ°κ°„μ΄ λλ‚¬μ„ λ• λ” μ΄μƒ ν•΄λ‹Ή IPμ£Όμ†κ°€ ν•„μ”ν•μ§€ μ•λ‹¤λ©΄ ν•΄μ (Release)λ¥Ό ν•΄μ•Ό ν•¨.
- DHCP Release κ³Όμ •μ„ ν†µν•΄ ν•΄μ ν•  μ μμ.
  - ν΄λΌμ΄μ–ΈνΈκ°€ `RELEASE` λ©”μ‹μ§€λ¥Ό μ λ‹μΊμ¤νΈλ΅ μ „μ†΅ν•κ³  IPμ£Όμ†λ¥Ό λ°ν™ν•¨.

## **π’¨ DHCP Relay Agent**

### **L2, L3, L4 Switch**

| Switch | Description |
| --- | --- |
| L2 Switch | MAC μ£Όμ†λ¥Ό κΈ°λ°μΌλ΅ λ°μ΄ν„°λ¥Ό μ „λ‹¬ν•λ” μ¤μ„μΉ, Layer2 Switch |
| L3 Switch | κ³µμ κΈ°λΌκ³  μƒκ°ν•λ©΄ λ¨, νΈλν”½ λ¨λ‹ν„°λ§, VLAN λ“±μ κΈ°λ¥μ„ ν•λ” μ¤μ„μΉ, Layer3 Switch |
| L4 Switch | λ΅λ“λ°Έλ°μ‹± κΈ°λ°μΌλ΅ νΈλν”½ λ¶„μ‚°μ„ μ„ν• μ¤μ„μΉ, Layer4 Switch |

---

![dhcp_relay_server](https://www.cisco.com/c/dam/en/us/support/docs/switches/catalyst-9300-series-switches/217366-configure-dhcp-in-ios-xe-evpn-vxlan-02.png)

- μ„ DORA Processλ” DHCP μ„λ²„κ°€ κ°™μ€ μ„λΈλ„·μ— μ΅΄μ¬ν•΄μ•Ό κ°€λ¥ν•λ©° μΌλ°μ μΌλ΅ DHCP μ„λ²„λ” λ‹¤λ¥Έ μ„λΈλ„·μ— μ΅΄μ¬ν•¨.
- ν΄λΌμ΄μ–ΈνΈλ” L2 λ„¤νΈμ›ν¬μ— μ΅΄μ¬ν•λ”λ°, L2 λ„¤νΈμ›ν¬λ§λ‹¤ DHCP μ„λ²„κ°€ μ΅΄μ¬ν•λ” κ²ƒμ€ λΉ„ν¨μ¨μ μ„.
- λ³΄ν†µ DHCP μ„λ²„λ” L3 λ„¤νΈμ›ν¬μ— μ΅΄μ¬ν•λ©°, μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ L2 λ„¤νΈμ›ν¬μ—λ” DHCP Relay Agentκ°€ μ΅΄μ¬ν•¨.
- κ°€μ •μ©μ—μ„ κ³µμ κΈ°λ¥Ό μ‚¬μ©ν•μ—¬ IPμ£Όμ†λ¥Ό ν• λ‹Ήλ°›λ” κ²½μ° κ³µμ κΈ° λ‚΄μ— DHCP μ„λ²„κ°€ μ΅΄μ¬ν•λ―€λ΅ λ‹¤λ¥Έ λ„¤νΈμ›ν¬μ— μ”μ²­ν•  ν•„μ”κ°€ μ—†μ§€λ§, κΈ°μ—…μ κ²½μ° DHCPκ°€ λΌμ°ν„° λ°–μ— μ΅΄μ¬ν•λ” κ²½μ°κ°€ μμ.

## **π‘ DHCP μ¥μ **

- IPμ£Όμ† κ΄€λ¦¬ μ©μ΄
  - DHCPκ°€ μ—†λ” λ„¤νΈμ›ν¬μ—μ„λ” IPμ£Όμ†λ¥Ό μλ™μΌλ΅ μ§€μ •ν•΄μ¤μ•Ό ν•¨.
  - μ¶©λμ΄ λ°μƒν•  μ μμΌλ©°, IPμ£Όμ†λ¥Ό μ¬μ‚¬μ©ν•κΈ° μ„ν•΄ IPμ£Όμ†λ¥Ό ν•΄μ ν•΄μ•Ό ν•¨.
  - ν΄λΌμ΄μ–ΈνΈκ°€ λ‹¤λ¥Έ λ„¤νΈμ›ν¬λ΅ μ΄λ™ν•κ² λλ©΄ ν•΄λ‹Ή ν΄λΌμ΄μ–ΈνΈλ¥Ό μλ™μΌλ΅ μμ •ν•΄μ¤μ•Ό ν•¨.
- IPμ£Όμ† κµ¬μ„± μ‹ λΆ°μ„±
  - λ™μΌν• IPμ£Όμ†λ¥Ό μ΄μ©ν•λ” ν΄λΌμ΄μ–ΈνΈ μ‚¬μ΄μ μ¶©λμ„ λ°©μ§€ν•¨.
  - μ¶©λμ΄ λ°μƒν•λ” κ²½μ° λ‘ ν΄λΌμ΄μ–ΈνΈ λ¨λ‘ μΈν„°λ„·μ— μ—°κ²°ν•μ§€ λ»ν•κ² ν•¨.
- λ†’μ€ μ΄λ™μ„±
  - ν΄λΌμ΄μ–ΈνΈκ°€ λ‹¤λ¥Έ λ„¤νΈμ›ν¬λ΅ μ΄λ™ν•λ”λΌλ„ IPμ£Όμ†λ¥Ό λ³€κ²½ν•  ν•„μ”κ°€ μ—†μ.

## **π‘ DHCP λ‹¨μ **

- IPμ£Όμ† ν• λ‹Ήμ΄ DHCP μ„λ²„μ— μμ΅΄μ μ„.
  - DHCP μ„λ²„κ°€ λ‹¤μ΄λλ©΄ ν΄λΌμ΄μ–ΈνΈλ” μΈν„°λ„·μ— μ—°κ²°ν•  μ μ—†μ.
- DHCPλ΅ μΈν• λ‹¤μ–‘ν• λ³΄μ• λ¬Έμ κ°€ λ°μƒν•¨.
  - μΉμΈλ°›μ§€ μ•μ€ DHCP μ„λ²„κ°€ μλ»λ μ •λ³΄λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ κ³µν•  μ μμ.
  - μΉμΈλ°›μ§€ μ•μ€ ν΄λΌμ΄μ–ΈνΈκ°€ DHCP μ„λ²„λ¥Ό κ°€λ΅μ±„ λ¦¬μ†μ¤μ— λ€ν• μ ‘κ·Ό κ¶ν•μ„ μ–»μ„ μ μμ.
  - μ•…μ„± ν΄λΌμ΄μ–ΈνΈκ°€ DHCP λ¦¬μ†μ¤λ¥Ό μ†λ¨μ‹ν‚¬ μ μμ.

## **DHCP λ³΄μ• λ¬Έμ **

### **DHCP Spoofing**

- DHCPλ” UDP κΈ°λ°μΌλ΅ λ™μ‘ν•λ―€λ΅ ν•΄λ‹Ή DHCP μ„λ²„κ°€ μΈμ¦ λ μ„λ²„μΈμ§€ ν™•μΈν•  μ μ—†μ.
- DHCP ν”„λ΅ν† μ½μ΄ μΈμ¦μ΄ λ¶κ°€λ¥ν• μ·¨μ•½μ μ„ μ΄μ©ν•μ—¬ DHCP μ„λ²„λ΅ μ„μ¥ν•μ—¬ μ΅°μ‘λ μ •λ³΄λ¥Ό μ „μ†΅ν•λ” κ³µκ²©λ²•.

![dhcp_spoofing](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F9947BD3359EC4B7B20)

- DHCP Snoopingμ„ ν†µν•΄ DHCP Spoofing κ³µκ²©μ„ λ°©μ–΄ν•  μ μμ.
  - DHCP μ„λ²„λ΅λ¶€ν„° μ „λ‹¬λ°›μ€ DHCP ν¨ν‚·μ„ κ²€μ‚¬ν•μ—¬ μ„μ¥λ DHCP μ„λ²„λ΅λ¶€ν„° μ „λ‹¬λ°›μ€ ν¨ν‚·μΈμ§€ ν™•μΈν•λ” κΈ°λ¥μ„.

### **DHCP Starvation Attack**

![dhcp_starvation_attack](https://ars.els-cdn.com/content/image/1-s2.0-S0045790612001140-fx1.jpg)

- DHCPλ” MACμ£Όμ† κΈ°λ°μΌλ΅ ν΄λΌμ΄μ–ΈνΈλ“¤μ—κ² IPμ£Όμ†λ¥Ό ν• λ‹Ήν•¨.
- μ΄ μ μ„ μ΄μ©ν•μ—¬ MACμ£Όμ†λ¥Ό λλ¤ν•κ² λ³€κ²½ν•λ©° DHCP μ„λ²„μ— μ”μ²­μ„ λ³΄λ‚΄ IPμ£Όμ†λ¥Ό ν• λ‹Ήλ°›λ” κ³µκ²©λ²•.
- DHCP μ„λ²„κ°€ IPμ£Όμ†λ¥Ό ν• λ‹Ήν•  μ μλ” μµλ€ κ°μλ¥Ό λ„μ–΄μ„λ” μ”μ²­μ„ λ³΄λ‚΄λ©΄μ„ μ„λ²„μ μμ›μ„ μ†λ¨μ‹ν‚¤κ³  κ°€μ© IPμ£Όμ†λ¥Ό λ¨λ‘ ν• λ‹Ήν•κ² λλ©΄ μ •μƒ ν΄λΌμ΄μ–ΈνΈλ” IPμ£Όμ†λ¥Ό ν• λ‹Ήλ°›μ§€ λ»ν•¨.
- DoS κ³µκ²©μ΄λΌκ³  ν•  μ μμ.
