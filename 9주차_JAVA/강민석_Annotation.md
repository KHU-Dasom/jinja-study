# Annotation 

## π“ƒλ°°κ²½

μ–΄λ…Έν…μ΄μ…μ μλ―Έλ” β€μ£Όμ„β€™μ΄λ‹¤. μ£Όμ„μ€ μ½”λ“λ΅λ§ μ•κΈ° νλ“  λ‚΄μ©μ΄λ‚ μ½”λ“λ΅ μ„¤λ…ν•κΈ° μ–΄λ ¤μ΄ λ””ν…μΌν• λ¶€λ¶„μ„ μ„¤λ…ν•κΈ° μ„ν•΄ μ¶”κ°€ν•κΈ°λ„ ν•λ‹¤.

μ–΄λ…Έν…μ΄μ…μ€ κ·Έλ ‡κΈ°μ— μ†μ¤μ½”λ“ μ•μ— λ‹¤λ¥Έ ν”„λ΅κ·Έλ¨μ„ μ„ν• μ •λ³΄λ¥Ό λ―Έλ¦¬ μ•½μ†λ ν•μ‹μΌλ΅ ν¬ν•¨μ‹ν‚¤κΈ° μ„ν•΄ μ‘μ„±ν•λ‹¤.

κΈ°μ΅΄μ μλ°” μ›Ή μ–΄ν”λ¦¬μΌ€μ΄μ…μ€ κµ¬μ„±κ³Ό μ„¤μ •κ°’λ“¤μ„ μ™Έλ¶€ XMLμ„¤μ • νμΌμ— λ…μ‹ν•μ—¬ ν”„λ΅κ·Έλλ° λμ—λ‹¤. μ™Έλ¶€μ—μ„ λ³€κ²½λ  μ μλ” κ°’μ„ κ΄€λ¦¬ν•κΈ°μ— μ¬μ»΄νμΌ μ—†μ΄ μ‰½κ² λ³€κ²½μ‚¬ν•­μ„ μ μ©ν•  μ μμ—μ§€λ§, ν”„λ΅κ·Έλ¨μ κ·λ¨κ°€ μ»¤μ§μλ΅ μ„¤μ •μ„ λ‹¤ μ μ–΄μ¤μ•Όν–κ³ , ν”„λ΅κ·Έλ¨μ„ μ‘μ„±ν• λ• λ§λ‹¤ λ§μ€ μ„¤μ •μ„ μ‘μ„±ν•΄μ•Όν–κΈ°μ— λ¬Έμ μ μ΄ μμ—λ‹¤. μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ κ³ μ•λ λ¬Έλ²•μ΄ μ–΄λ…Έν…μ΄μ…μ΄λ‹¤. μ–΄λ…Έν…μ΄μ…μ€ λ°νƒ€μ„ λλ” μ»΄νμΌμ— μ–΄λ…Έν…μ΄μ…μ€ ν•΄μ„λ  μ μλ‹¤. μ–΄λ…Έν…μ΄μ…μ€ λ³΄ν†µ λ¬Έμ„ν™”, μ»΄νμΌλ¬ μ²΄ν¬, μ½”λ“ λ¶„μ„μ„ μ„ν• μ©λ„λ΅ μ‚¬μ©λλ”λ° λ³Έμ§μ μΈ λ©μ μ€ μ†μ¤ μ½”λ“μ— λ©”νƒ€λ°μ΄ν„°λ¥Ό ν‘ν„ν•λ” κ²ƒμ΄λ‹¤.

μ†μ¤ μ½”λ“μ— λ©”νƒ€λ°μ΄ν„°λ¥Ό ν‘ν„ν•λ‹¤λ” κ²ƒμ€ μ •λ³΄μ— λ€ν• μ •λ³΄λ¥Ό ν‘μ‹ν•λ‹¤λ” μλ―ΈμΈλ°..

@OverrideλΌλ” μ–΄λ…Έν…μ΄μ…μ€ λ³΄ν†µ λ§μ΄ μ ‘ν•΄λ΄¤μΌλ‹κΉ μ΄λ¥Ό ν†µν•΄ μ„¤λ…μ„ ν•μλ©΄ `@Override` μ–΄λ…Έν…μ΄μ…μ κΈ°λ¥μ€ λ’¤μ—μ„λ„ μ„¤λ…ν•κ² μ§€λ§ λ…μ‹μ μΌλ΅ μ΄ ν•¨μκ°€ μ¤λ²„λΌμ΄λ”© λ¨μ„ μ•λ ¤μ£Όκ³  μ¤λ²„λΌμ΄λ”©μ„ ν•μ§€ μ•μΌλ©΄ λΉ¨κ°„ λ°‘μ¤„μ΄ μƒκΈ°λ©΄μ„ μ»΄νμΌλ¬μ—μ„ κ²½κ³ λ¥Ό ν•΄μ¤€λ‹¤. μ΄κ²ƒμ€ β€μ΄ ν•¨μλ” μ¤λ²„λΌμ΄λ”© ν•΄μ•Όν•΄!β€™λΌλ” μ •λ³΄λ¥Ό ν¬ν•¨ν•κ³  μκΈ°μ— ν•¨μ(μ •λ³΄)μ— λ€ν• μ •λ³΄λ¥Ό ν‘μ‹ν•λ‹¤λ” κ²ƒμ΄λ‹¤.

```java
// Annotationμ„ μ‚¬μ©ν•λ°©μ‹
@Service
public class MyService {
    // ...
}

//xmlμ„ μ‚¬μ©ν• λ°©μ‹
<bean id="myService" class="com.example.MyService">
   <!-- ... -->
</bean>

```

## π“ƒμΆ…λ¥

μ–΄λ…Έν…μ΄μ…μ€ Javaμ— κΈ°λ³Έμ μΌλ΅ λ‚΄μ¥λμ–΄ μλ” κ²ƒλ“¤λ„ μλ”λ°, μ΄λ¥Ό Built-in-Annotationμ΄λΌκ³  ν•λ‹¤. μ£Όλ΅ μ»΄νμΌλ¬λ¥Ό μ„ν• κ²ƒμΌλ΅ μ»΄νμΌλ¬μ— μ μ©ν• μ •λ³΄λ¥Ό μ¤€λ‹¤.

λ€ν‘μ μΌλ΅

### Built-in-Annotation

**@Override**

μ„μ—μ„ μ„¤λ…ν–μ§€λ§ μ»΄νμΌλ¬μ—κ² ν„μ¬ λ©”μ†λ“κ°€ μνΌν΄λμ¤μ λ©”μ†λ“λ¥Ό μ¤λ²„λΌμ΄λ“ν• λ©”μ†λ“λΌλ” κ²ƒμ„ λ…μ‹ν•λ‹¤.

μ΄λ¥Ό ν†µν•΄ λ©”μ†λ“ μ΄λ¦„ μ¤νƒ€λ‚ μ¤λ²„λΌμ΄λ”©μ„ ν•μ§€ μ•μΌλ©΄ μ»΄νμΌλ¬κ°€ μ΅μ•„μ¤€λ‹¤.

**@Deprecated**

μ°¨ν›„ λ²„μ „μ— μ§€μ›λμ§€ μ•μ„ μ μκΈ° λ•λ¬Έμ— λ” μ΄μƒ μ‚¬μ©λμ§€ λ§μ•„μ•Ό ν•  λ©”μ†λ“λ¥Ό λ§ν•λ‹¤.

μλ΅λ” μµκ·Ό μ¤ν”„λ§μ—μ„ μ›Ήμ„¤μ •μ„ μ„ν• μ–΄λ‘ν„°μ— @Deprecatedκ°€ λ‹¬λ¦¬κ² λμ—λ‹¤.

```java
@Deprecated
public abstract class WebSecurityConfigurerAdapter implements WebSecurityConfigurer<WebSecurity> {
    ...
}
```

**@SupreesWarning**

ν”„λ΅κ·Έλλ¨Έμ μλ„λ¥Ό μ»΄νμΌλ¬μ—κ² μ „λ‹¬ν•μ—¬ κ²½κ³ λ¥Ό μ κ±°ν•λ‹¤.

νμ‚¬μ—μ„ μ“΄κ±Έ λ³Έ μ μ΄ μλ”λ° μ΄κ±Έ μ§€μ°λ©΄ λ…Έλ€μ¤„(warning)μ΄ λ¨λκ²ƒμ΄ μ΄ μ–΄λ…Έν…μ΄μ…μ„ λ‹¬λ©΄ μ‚¬λΌμ§€λ”κ²ƒμ„ μ• μ μμ—λ‹¤.

**@SafeVarargs**

@SupressWarningκ³Ό λΉ„μ·ν•λ°, λ³€μλ‚ νƒ€μ…μ— λ€ν• κ²½κ³ μ„±λ„ λ¬΄μ‹ν•λ‹¤λ” μλ―Έλ‹¤.

**@FunctionalInterface**

μ»΄νμΌλ¬μ—κ² ν•΄λ‹Ή μΈν„°νμ΄μ¤κ°€ ν•¨μν• μΈν„°νμ΄μ¤λΌλ” κ²ƒμ„ μ•λ¦°λ‹¤. @Overrideμ™€ λΉ„μ·ν•κ² ν”„λ΅κ·Έλλ¨Έκ°€ μ‹¤μλ¥Ό ν•λ”κ²ƒμ„ λ―Έμ—°μ— λ°©μ§€ν•λ‹¤. μλ°”μ λλ‹¤μ‹μ€ ν•¨μν• μΈν„°νμ΄μ¤λ΅λ§ μ ‘κ·Όμ΄ κ°€λ¥ν•κΈ° λ•λ¬Έμ΄λ‹¤.


**@Native**

Java 8λ²„μ „ μ΄ν›„μ μƒλ΅μ΄ μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.

μ΄λ” ν•„λ“μ—λ§ μ μ©ν•  μ μκ³  native codeμμ—­κ³Ό κ΄€λ ¨μ΄ μλ‹¤λ”κ²ƒμ„ λ…μ‹μ μΌλ΅ μ•λ ¤μ¤€λ‹¤.

```java
public final class Integer {
    @Native public static final int MIN_VALUE = 0x80000000;
    // omitted
}
```

λ„¤μ΄ν‹°λΈ μμ—­μ€ μ™Έλ¶€ μ–Έμ–΄λ΅ μ‘μ„±λ νμΌμ„ μ €μ¥ν•λ” λ©”λ¨λ¦¬ μμ—­μΈλ° λ³΄ν†µ Cμ–Έμ–΄λ΅ μ‘μ„±λμ–΄ μκΈ°μ— μ΄λ¥Ό λ…μ‹ν•λ” μλ―Έλ΅ μ“°μΈλ‹¤. Native λ©”μ„λ“μ—μ„ μ°Έμ΅°λλ” μƒμ μ•μ— λ¶™μΈλ‹¤κ³  ν•λ‹¤.

### Meta-Annotation

μ–΄λ…Έν…μ΄μ…μ— μ‚¬μ©λλ” μ–΄λ…Έν…μ΄μ…μΌλ΅ ν•΄λ‹Ή μ–΄λ…Έν…μ΄μ…μ λ™μ‘λ€μƒμ„ κ²°μ •ν•λ‹¤. μ£Όλ΅ μƒλ΅μ΄ μ–΄λ…Έν…μ΄μ…μ„ μ •μν•  λ• μ‚¬μ©ν•λ‹¤.

**@Target**

μ–΄λ…Έν…μ΄μ…μ΄ μ μ©κ°€λ¥ν• λ€μƒμ„ μ§€μ •ν•λ”λ° μ‚¬μ©ν•λ‹¤. {}λ¥Ό ν†µν•΄ μ—΄κ±°ν•  μλ„ μλ‹¤. ν¨ν‚¤μ§€, μ–΄λ…Έν…μ΄μ…, λ©¤λ²„ λ³€μ λ“±μ— λ”°λΌ μ§€μ •ν•  μ μλ‹¤.

**@Retention**

μ–΄λ…Έν…μ΄μ…μ΄ μ μ§€λλ” κΈ°κ°„μ„ μ§€μ •ν•λ‹¤. μ„Έ κ°€μ§€ μ μ§€μ •μ±…(retention policy)λ¥Ό μ‚¬μ©ν•  μ μλ‹¤.

SOURCE : μ†μ¤μ½”λ“(.java)κΉμ§€ λ‚¨μ•„μλ”λ‹¤.
CLASS : ν΄λμ¤ νμΌ(.class)κΉμ§€λ§ λ‚¨μ•„μλ”λ‹¤. = λ°”μ΄νΈ μ½”λ“
RUNTIME : λ°νƒ€μ„κΉμ§€λ§ λ‚¨μ•„μλ”λ‹¤.
μ΄λ ‡κ²λ§ μ„¤λ…ν•λ©΄ μ΄ν•΄κ°€ λμ§€ μ•λ”λ‹¤.

μ£Όμ!! λ νΌλ°μ¤κ°€ μκΈ΄ν•μ§€λ§ μ  μƒκ°μ„ κ³λ“  κ°μΈμ μΈ κ²¬ν•΄μ…λ‹λ‹¤.

λ¨Όμ € JVMμ΄ λ™μ‘ν•λ” λ°©μ‹μ„ μ•μ•„μ•Όν•  ν•„μ”κ°€ μλ‹¤.

```text
      compile              load
.java    ->     .class      ->      classLoader in JVM
```

μ΄λ ‡κ² λκΈ°μ— SOURCEλ” .javaμ‹μ μ— μ‚΄μ•„μκ³ , CLASSλ” .classμ‹μ μ— μ‚΄μ•„μμ„κ²ƒμ΄κ³  μ‹¤μ  ν”„λ΅κ·Έλ¨μ΄ κµ¬λ™λλ©΄μ„λ” λ°νƒ€μ„μ΄ λκ²ƒμ΄λ―€λ΅ RUNTIMEμ— μ‚΄μ•„μμ„ κ²ƒμ΄λ‹¤.

λ€ν‘μ μΌλ΅ λ΅¬λ³µμ @Getterλ” μ •μ±…μ΄ SOURCEλ΅ λμ–΄μλ”λ° μ»΄νμΌλ  λ• λ©”μ„λ“λ“¤μ get()ν•¨μλ¥Ό λ°”μ΄νΈμ½”λ“λ΅ μƒμ„±ν•΄ μ»΄νμΌμ„ μ‹μΌλ²„λ¦¬κ³  μ‚¬λΌμ§€κ² λλ”κ²ƒμ΄λ‹¤.

@NonNullμ μ •μ±…μ€ CLASSμΈλ° λ™μ‘λ°©μ‹μ€ μ΄κ² λ¶™μ–΄μλ”λ° nullμ„ λ„£κ²λλ©΄ λ…Έλ€μƒ‰ κ²½κ³ λ΅ ν”„λ΅κ·Έλλ¨Έμ—κ² μ•λ ¤μ£Όλ” λ™μ‘μ„ ν•λ‹¤.
Maven/Gradleλ΅ λ‹¤μ΄λ°›μ€ λΌμ΄λΈλ¬λ¦¬μ™€ κ°™μ΄ jarνμΌμ—λ” μ†μ¤κ°€ ν¬ν•¨λμ–΄ μμ§€ μ•κΈ°μ— SOURCEμ •μ±…μ„ μ‚¬μ©ν•λ”λ°μ— ν•κ³„κ°€ μλ‹¤. μ΄λ―Έ μ»΄νμΌλ νμΌμ΄κΈ°μ— μ–΄λ…Έν…μ΄μ… μ •λ³΄κ°€ λ‚¨μ•„μμ§€ μ•κΈ° λ•λ¬Έμ΄λ‹¤. κ·Έλ ‡κΈ°μ— .classλ§ λ‚¨μ•„μλ” λΌμ΄λΈλ¬λ¦¬ κ²½μ°μ— λ€ν•μ—¬ νƒ€μ…μ²΄μ»¤, IDEλ¶€κ°€κΈ°λ¥ λ“±μ„ μ‚¬μ©ν•  μ μμΌλ ¤λ©΄ CLASSμ— λ€ν• μ •μ±…μ΄ ν•„μ”ν•κ² λλ” κ²ƒμ΄λ‹¤.

RUNTIMEμ •μ±…μ— λ€ν•΄μ„λ” μλ°”μ Reflection APIλ“±μ„ ν†µν•μ—¬ λ°νƒ€μ„μ— μ–΄λ…Έν…μ΄μ… μ •λ³΄λ¥Ό μ• μ μλ‹¤λ” μλ―Έμ΄λ‹¤. @Controller, @Serviceμ™€ κ°™μ΄ μ¤ν”„λ§μ΄ μ¬λΌμ¤λ” λ°νƒ€μ„ μ‹μ μ— μ¤μΊ”μ΄ μ»΄ν¬λ„νΈ μ¤μΊ”μ΄ κ°€λ¥ν•΄μ•Όν•κΈ°μ— RUNTIMEμ •μ±…μ„ ν•„μ”λ΅ ν•λ‹¤.

**@Documented**

μ–΄λ…Έν…μ΄μ…μ— λ€ν• μ •λ³΄κ°€ javadocλ΅ μ‘μ„±ν• λ¬Έμ„μ— ν¬ν•¨λλ„λ΅ ν•  λ• μ‚¬μ©ν•λ” μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.

**@Inherited**

μ–΄λ…Έν…μ΄μ…μ΄ μμ† ν΄λμ¤μ—λ„ μƒμ†λλ„λ΅ ν•λ” μ–΄λ…Έν…μ΄μ…μ΄λ‹¤. μ¦‰, μ΅°μƒ ν΄λμ¤μ— λ¶™μ΄λ©΄ μμ† ν΄λμ¤λ„ μ΄ μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ€κ²ƒκ³Ό κ°™μ΄ μΈμ‹λλ‹¤.

## π“ƒ μ»¤μ¤ν…€ μ–΄λ…Έν…μ΄μ… λ§λ“¤κΈ°

μ»¤μ¤ν…€μ„ ν•΄μ£ΌκΈ° μ „μ— μ–΄λμƒν™©μ—μ„ μ“°μΌ μ μλ”μ§€ μ•μ•„μ•Όν•λ‹¤.

λ‚λ” μ¤ν”„λ§ μ‹νλ¦¬ν‹°μ—μ„ μ κ³µν•λ” κΈ°λ¥λ“¤μ„ μ‚¬μ©ν–μ„λ•, 

```java
@GetMapping
public UserResponse currentUser(@AuthenticationPrincipal UserAuth userAuth) {
    return userService.getCurrentUser(userAuth);
}
```

λΌλ” μ½”λ“λ¥Ό ν…μ¤νΈν•κ³  μ‹¶μ—λ‹¤. ν•μ§€λ§ ν…μ¤νΈ μ½”λ“μ—μ„λ” `@AuthenticationPrincipal`λ΅ λ“¤μ–΄μ™€μ•Όν•λ” μΈμμ²λ¦¬λ¥Ό μ–΄λ–»κ² ν• κΉ?

ν¬κ² 2κ°€μ§€ λ°©λ²•μ΄ μμ§€λ§ μ»¤μ¤ν…€ν•κΈ° μ‰¬μ›μ„ λ€ν‘μ μΌλ΅ μ“°μ΄λ” λ°©λ²• ν•κ°€μ§€λ¥Ό μ“°κ² λ‹¤.

`User`κ°μ²΄λ” `Id`, `email`,`username`μ ν•„λ“λ¥Ό κ°€μ§„λ‹¤κ³  μΉλ‹¤.

λ¨Όμ € μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄μ„λ” μ μ €μ •λ³΄λ¥Ό μ¤ν”„λ§ μ‹νλ¦¬ν‹° μ»¨ν…μ¤νΈμ— λ„£κ³  μ΄λ¥Ό ν…μ¤νΈν• λ• κΊΌλ‚΄μ„ μ“°κ±°λ‚ κ·Έλμ•Όν•  κ²ƒμ΄λ‹¤.

μ΄ κ³Όμ •μ„ ν…μ¤νΈ μ½”λ“ κ±°μΉκΈ° μ „μ— ν•΄μ¤μ•Όν•  κ²ƒμΈλ° μ–΄λ–»κ² ν•΄μ¤„κΉ?

κ°€μ¥ μ›λ΅ μ μΈ λ°©λ²•μ€ λ‹¤μκ³Ό κ°™λ‹¤.

```java
UserAuth userAuth = UserAuth.builder()
                            .username("kms")
                            .email("test@gmail.com")
                            .build();
Authentication auth = new UsernamePasswordAuthenticationToken(userAuth, "", null);
SecurityContextHolder.getContext().setAuthentication(auth);
```

μ΄λ°μ‹μΌλ΅ `UserAuth` μΈμ¤ν„΄μ¤λ¥Ό λ§λ“¤μ–΄μ„ μ‹νλ¦¬ν‹° μΈμ¦μ •λ³΄ μ»¨νƒμ¤νΈμ— λ„£μ–΄μ£Όλ©΄ λλ‹¤.

μ΄ λ°©μ‹μ€ λ§¤ ν…μ¤νΈμ½”λ“λ§λ‹¤ λ„£λ”κ²ƒλ„ λ²κ±°λ΅­κ³ , ν•„μ”ν•κ³³μ—λ§ κ°€μ Έλ‹¤ μ“°κΈ°μ—λ„ λ¶νΈν•λ‹¤.

ν…μ¤νΈμ½”λ“μ„μ— μ–΄λ…Έν…μ΄μ…μ„ λ‹¬κ³ , κ·Έ λ¶€λ¶„μ—λ§ μ„¤μ •κ°’μ„ μ»¨νƒμ¤νΈμ— λ„£κ³  μ“°λ©΄ μΆ‹μ„κ²ƒ κ°™λ‹¤.

μ¤ν”„λ§ μ‹νλ¦¬ν‹°μ—μ„λ” `WithSecurityContextFactory`λΌλ” μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ‹¤.

μ΄ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ©΄ μ‚¬μ©μ μΈμ¦μ •λ³΄λ¥Ό μ»¨νƒμ¤νΈμ— λ„£μ„ μ μκ² **κ°•μ **ν•λ” μΈν„°νμ΄μ¤λ΅, μ–΄λ…Έν…μ΄μ… νƒ€μ…κ³Ό ν•λ‚μ λ©”μ†λ“λ¥Ό κ°€μ§„λ‹¤. κ·Έ λ©”μ†λ“λ” μ»¨νƒμ¤νΈ κ°μ²΄λ¥Ό μƒμ„±ν•΄μ•Όλ§ ν•λ‹¤.

```java
public interface WithSecurityContextFactory<A extends Annotation> {
    SecurityContext createSecurityContext(A annotation);
}
```

κµ¬ν„ν•΄μ•Όν•  μΈμλ΅ μ–΄λ…Έν…μ΄μ… νƒ€μ…μ΄ λ“¤μ–΄μ™€μ•Όν•λ‹¤. ν•΄λ‹Ή μ–΄λ…Έν…μ΄μ…μ„ κ°€μ§€κ³  μ¤ν”„λ§ μ‹νλ¦¬ν‹° μ»¨νƒμ¤νΈμ— μ μ €μ •λ³΄ κ°’μ„ λ„£μ–΄μ¤„ κ²ƒμ΄λ‹¤.

κ·Έλ¬λ©΄ ν•΄λ‹Ή μ–΄λ…Έν…μ΄μ…μ„ λ§λ“¤μ–΄μ•Όν•λ‹¤.

```java
@Retention(RetentionPolicy.RUNTIME)
@WithSecurityContext(factory = WithAuthUserSecurityContextFactory.class)
public @interface WithAuthUser {
    long id() default 1L;
    String email() default "test@gmail.com";
    String username() default "kms";
}
```

- μ»¤μ¤ν…€ μ–΄λ…Έν…μ΄μ…μ„ λ§λ“¤κΈ° μ„ν•΄μ„λ” `@interface`λ¥Ό λ¶™μ—¬μ•Όν•λ‹¤. 
- `@Retention()`μ„ ν†µν•΄ ν•΄λ‹Ή μ–΄λ…Έν…μ΄μ…μ΄ λ°νƒ€μ„λ•κΉμ§€ λ‚¨μ•„μμ–΄μ•Όν•λ‹¤κ³  ν•λ‹¤.
- `@WithSecurityContext()`λΌλ” μ–΄λ…Έν…μ΄μ…μ€ μ°λ¦¬κ°€ λ§λ“¤ `WithSecurityContextFactory`κµ¬ν„μ²΄ ν΄λμ¤ μ •λ³΄λ¥Ό λ„£μΌλ©΄ λλ‹¤. μ¦‰, `WithAuthUserSecurityContextFactory`λ” `WithSecurityContextFactory`λ¥Ό κµ¬ν„ν• κµ¬ν„μ²΄μ΄λ‹¤.

μ΄μ  κµ¬ν„μ²΄λ¥Ό λ§λ“¤μ–΄λ³΄κ² λ‹¤.
```java
public class WithAuthUserSecurityContextFactory implements WithSecurityContextFactory<WithAuthUser> {

    @Override
    public SecurityContext createSecurityContext(WithAuthUser annotation) {
        Long id = annotation.id();
        String email =  annotation.email();
        String username = annotation.username();

        UserAuth userAuth = UserAuth.builder()
                .email(email)
                .username(username)
                .id(id)
                .build();
        Authentication authentication = new UsernamePasswordAuthenticationToken(userAuth,"",null);
        SecurityContext context = SecurityContextHolder.getContext();
        context.setAuthentication(authentication);
        return context;

    }

}
```

μΈν„°νμ΄μ¤μ—μ„ μ–΄λ…Έν…μ΄μ… νƒ€μ…μ„ λ°›μ•μΌλ―€λ΅ μ°λ¦¬κ°€ λ§λ“  μ–΄λ…Έν…μ΄μ…μ„ μΈμλ΅ λ„£μ–΄μ£Όκ³ , μ–΄λ…Έν…μ΄μ…μ—μ„ κ°’μ„ κΊΌλ‚΄μ„ μ»¨νƒμ¤νΈμ— λ„£λ” ν΄λμ¤λ΅ λ³Ό μ μλ‹¤.

μ •λ¦¬ν•μλ©΄ `WithSecurityContextFactory`λ” μ¤ν”„λ§ μ‹νλ¦¬ν‹°μ—μ„ μ κ³µν•λ” μ»¨νƒμ¤νΈμ— μ μ €μ •λ³΄λ¥Ό λ„£κ³ , κ·Έ μ»¨νƒμ¤νΈλ¥Ό λ°ν™ν•λ” λ©”μ†λ“λ¥Ό κµ¬ν„ν•λ” λ©”μ†λ“λ¥Ό κ°•μ ν•λ” μΈν„°νμ΄μ¤μ΄λ‹¤.

μ΄λ¥Ό κµ¬ν„ν• κ²ƒμ΄ `WithAuthUserSecurityContextFactory`μ΄κ³  **μ–΄λ…Έν…μ΄μ…**μ„ μΈμλ΅ λ°›κ² λμ–΄μκ³ , κ·Έ μ–΄λ…Έν…μ΄μ…μ€ κ°λ°μκ°€ λ§λ“  μ»¤μ¤ν…€ μ–΄λ…Έν…μ΄μ…μ΄ λκ² λ‹¤.

κ·ΈλΌ μ–΄λ–¤ λ°©μ‹μΌλ΅ μ΄ μ»¨νƒμ¤νΈλ¥Ό ν…μ¤νΈλ•λ§λ‹¤ κ°€μ Έλ‹¤ μ“΄λ‹¤λ” κ²ƒμΈκ°€?

κ·Έλ¬λ©΄ `@WithSecurityContext(factory = WithAuthUserSecurityContextFactory.class)`μ μλ―Έλ” λ¬΄μ—‡μΌκΉ?

`@WithSecurityContext()`λΌλ” μ–΄λ…Έν…μ΄μ…μ€ λ‹¤μκ³Ό κ°™μ΄ κµ¬ν„λμ–΄ μλ‹¤.

```java
@Target({ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Inherited
@Documented
public @interface WithSecurityContext {
    Class<? extends WithSecurityContextFactory<? extends Annotation>> factory();

    TestExecutionEvent setupBefore() default TestExecutionEvent.TEST_METHOD;
}
```

μ„μ—μ„λ¶€ν„° ν•΄μ„μ„ ν•μλ©΄

- `@Target({ElementType.ANNOTATION_TYPE})`: μ–΄λ…Έν…μ΄μ…μ— λ¶™μ„ μ μλ‹¤.
- `@Retention(RetentionPolicy.RUNTIME)`: λ°νƒ€μ„λ•κΉμ§€ μ‚΄μ•„μλ‹¤. μ΄λ¥Ό ν†µν•΄ `Refelction`μ„ μ‚¬μ©ν•  μ μλ‹¤.
- `@Inherited`: μƒμ†μ„ κ°€λ¥ν•κ² ν•λ‹¤.
- `@Documented`: λ¬Έμ„ν™”κ°€ λμ–΄μλ‹¤.

- `factory()`λ©”μ„λ“λ” κµ¬ν„λ `WithSecurityContextFactory`λ¥Ό λ¦¬ν„΄ν•λ„λ΅ λμ–΄μλ‹¤.
- `setupBefore()`λ” κΈ°λ³Έκ°’μΌλ΅ `TestExecutionEvent.TEST_METHOD`λ¥Ό κ°€μ§€λ„λ΅ λμ–΄μλ‹¤. μ΄ λ»μ€ ν…μ¤νΈ λ©”μ„λ“κ°€ μν–‰λκΈ° μ „μ— μ–΄λ…Έν…μ΄μ…μ„ μ‹¤ν–‰ν•λ‹¤λ” λ»μ΄λ‹¤.


μ¦‰, ν…μ¤νΈ λ©”μ„λ“κ°€ μ‹¤ν–‰λκΈ° μ „μ— `factory()`λ©”μ„λ“μ— λ°ν™λ μ»¨νƒμ¤νΈμ μ„¤μ • λ° μ΄κΈ°ν™”λ¥Ό μ‹¤ν–‰ν•κ³  ν•΄λ‹Ή μ„¤μ •κ°’μ„ κ°€μ§€κ³  ν…μ¤νΈ λ©”μ„λ“μ μΈμ¦ κ³Όμ •μ„ μν–‰ν•λ‹¤.


## π“ƒ ν•΄μ„

μ•„λ¬΄λ° μ •λ³΄κ°€ μ—†λ”λ° ν•΄μ„μ„ μ–΄λ–»κ² ν• κ²ƒμΈκ°€? μ‚¬μ‹¤ μ–΄λ…Έν…μ΄μ…μ λ‚΄λ¶€ λ©”μ„λ“ κµ¬ν„λ°©μ‹μ€ λ³΄κΈ°λ” κµ‰μ¥ν κΉλ‹¤λ΅­λ‹¤ IDEμ—μ„λ„ νƒ€κ³ κ° μλ„ μ—†κΈ°μ— μ΄λ¥Ό ν•΄μ„ν•κΈ° μ„ν•΄μ„λ”..

κ³µμ‹λ¬Έμ„λ΅¤ λ³΄κ±°λ‚ μ—¬λ¬ μ»¤λ®¤λ‹ν‹°λ¥Ό λμ•„λ‹¤λ‹λ©΄μ„ μ•μ•„λ³΄κ±°λ‚ μ§μ ‘ μ—¬λ¬ μƒν™©μ„ ν…μ¤νΈμ½”λ“λ¥Ό μ‘μ„±ν•΄μ„ μ μ¶”ν•κ±°λ‚ ν•λ” λ“±μ λ°©λ²•λ°–μ— μ—†λ‹¤κ³  λ‚λ” μ•κ³  μλ‹¤.

λ” μ°Ύμ•„λ΄λ„, μ½”λ“ λ‹¨μ—μ„ λ‚΄λ¶€ κµ¬ν„λ°©μ‹μ„ μ •ν™•ν μ•κΈ° μ„ν•΄μ„λ” λ³ΈμΈμ΄ μ§μ ‘ μ μ¶”ν•λ” μ λ°–μ— μ—†λ‹¤λ” λ§μ΄λ‹¤.

<img width="1698" alt="image" src="https://user-images.githubusercontent.com/30401054/214232944-d6acee78-f797-44ef-ba59-fb4ead65c773.png">

μ™ κ·Έλ°μ‹μΌλ΅ λ§λ“¤μ—μ„κΉ? **chatGPT**μ λ§μ„ μ”μ•½ν•μλ©΄ λ‹¤μκ³Ό κ°™μ΄ μ •λ¦¬ν•  μ μλ‹¤.

μ°λ¦¬κ°€ μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ” μ΄μ μ™€ λΉ„μ·ν•λ°, λ‚΄λ¶€ κµ¬ν„μ€ μ™Έλ¶€ μ‚¬μ©μμ—κ² λ³΄μ—¬μ£Όμ§€ μ•λ„λ΅ ν•¨μΌλ΅μ¨, μΊ΅μν™”μ™€ μ¶”μƒν™”λ¥Ό λ³΄μ¥ν•κ³  μ‚¬μ©μ μ…μ¥μ—μ„λ” λ‚΄λ¶€ κµ¬ν„λ°©μ‹μ„ λ°λΌλ„ μ‚¬μ©λ§ ν•  μ μκ² λ§λ“ λ‹¤.

μ‚¬μ‹¤ `Reflection`μ„ ν†µν•΄μ„ μ–΄λ…Έν…μ΄μ… μ†μ„±κ°’λ“¤μ„ μ°Ύκ³  κ·Έ λ‚΄λ¶€κµ¬ν„μ„ μ μ¶”ν•  μ μκΈ°λ„ ν•λ‹¤.






